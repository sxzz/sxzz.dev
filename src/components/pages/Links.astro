---
import { friends, type Friend } from '../../data/site'
import { getPageCopy } from '../../i18n/pages'
import Layout from '../../layouts/Layout.astro'
import type { Lang } from '../../i18n/utils'

interface Props {
  lang: Lang
}

const { lang } = Astro.props
const copy = getPageCopy('links', lang)

function getFriendName(friend: Friend): string {
  if (typeof friend.name === 'string') return friend.name
  return friend.name[lang]
}

function shuffleArray<T>(array: T[]): T[] {
  const shuffled = array.slice()
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1))
    ;[shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]
  }
  return shuffled
}
---

<Layout title={copy.title} description={copy.description}>
  <main class="flex flex-1 justify-center px-6 py-16 md:px-12">
    <div class="max-w-2xl w-full space-y-10">
      <header class="fade-in-up" style="animation-delay: 80ms">
        <h1
          class="text-3xl text-stone-900 font-700 tracking-tight font-serif md:text-4xl dark:text-white"
        >
          {copy.heading}
        </h1>
        <p class="mt-2 text-stone-500 dark:text-stone-400">
          {copy.subheading}
        </p>
      </header>

      <div
        id="friends-grid"
        class="fade-in-up grid grid-cols-1 gap-4 sm:grid-cols-2"
        style="animation-delay: 160ms"
      >
        {
          shuffleArray(friends).map((friend) => (
            <a
              href={friend.href}
              target="_blank"
              rel="noopener noreferrer"
              class="group flex items-center gap-4 border border-stone-200/80 rounded-xl p-4 transition-all duration-200 dark:border-stone-800/80 hover:border-stone-300 hover:bg-stone-100/50 dark:hover:border-stone-700 dark:hover:bg-stone-900/50"
            >
              <img
                src={friend.avatar}
                alt={getFriendName(friend)}
                class="h-12 w-12 shrink-0 rounded-full object-cover ring-1 ring-stone-200/60 dark:ring-stone-700/40"
              />
              <div class="min-w-0">
                <div class="text-sm text-stone-800 font-600 transition-colors duration-200 dark:text-stone-200 group-hover:text-stone-950 dark:group-hover:text-white">
                  {getFriendName(friend)}
                </div>
                <div class="mt-0.5 truncate text-xs text-stone-500 dark:text-stone-400">
                  {friend.bio}
                </div>
              </div>
            </a>
          ))
        }
      </div>
    </div>
  </main>
</Layout>

<script>
  function shuffleFriendsGrid() {
    const grid = document.querySelector('#friends-grid')
    if (!grid) return

    const children = [...grid.children]
    for (let i = children.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1))
      ;[children[i], children[j]] = [children[j], children[i]]
    }
    grid.append(...children)
  }

  document.addEventListener('astro:page-load', shuffleFriendsGrid)
</script>
