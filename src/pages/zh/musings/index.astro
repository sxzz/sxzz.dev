---
import { getCollection } from 'astro:content'
import { getPageCopy } from '../../../i18n/pages'
import { getLangFromUrl, useTranslatedPath } from '../../../i18n/utils'
import Layout from '../../../layouts/Layout.astro'
import { formatDate } from '../../../utils/content'

const lang = getLangFromUrl(Astro.url)
const translatePath = useTranslatedPath(lang)
const copy = getPageCopy('musings', lang)

const musings = (await getCollection('musings')).toSorted(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
)

const getMusingTitleTransitionName = (id: string) =>
  `musing-title-${
    id
      .toLowerCase()
      .replaceAll(/[^a-z0-9_-]+/g, '-')
      .replaceAll(/^-+|-+$/g, '')
  }`
---

<Layout title={copy.title} description={copy.description}>
  <main class="flex flex-1 justify-center px-6 py-16 md:px-12">
    <div class="max-w-xl w-full space-y-10">
      <header class="fade-in-up animate-delay-80">
        <h1 class="text-3xl text-stone-900 font-700 tracking-tight md:text-4xl dark:text-white">
          {copy.heading}
        </h1>
      </header>

      <ul class="fade-in-up animate-delay-160 space-y-1">
        {musings.map((post) => (
          <li>
            <a
              href={translatePath(`/musings/${post.id}/`)}
              class="group flex items-baseline gap-4 py-3 transition-colors duration-200"
            >
              <time
                class="shrink-0 text-xs text-stone-500 tabular-nums dark:text-stone-400"
              >
                {formatDate(post.data.date, lang)}
              </time>
              <span
                class="list-title text-stone-700 transition-colors duration-200 dark:text-stone-300 group-hover:text-stone-900 dark:group-hover:text-white"
                style={`view-transition-name: ${
                  getMusingTitleTransitionName(
                    post.id,
                  )
                };`}
              >
                {post.data.title}
              </span>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </main>
</Layout>
